<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Judge0 API Test - WMOJ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #4a5568;
            margin-top: 0;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #3730a3;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .loading { border-left: 4px solid #f59e0b; }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success { background: #dcfce7; color: #166534; }
        .status.error { background: #fef2f2; color: #dc2626; }
        .status.loading { background: #fef3c7; color: #d97706; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Judge0 API Integration Test</h1>
        <p style="text-align: center; color: #6b7280;">Testing comprehensive code execution with detailed results</p>

        <div class="test-section">
            <h3>üêç Python Tests</h3>
            <button onclick="testJudge0('python', 'basic')">Basic Hello World</button>
            <button onclick="testJudge0('python', 'input')">Input Processing</button>
            <button onclick="testJudge0('python', 'math')">Math Operations</button>
            <button onclick="testJudge0('python', 'complex')">Complex Algorithm</button>
            <button onclick="testJudge0('python', 'error')">Runtime Error</button>
            <div id="python-results" class="results" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üü® JavaScript Tests</h3>
            <button onclick="testJudge0('javascript', 'basic')">Basic Hello World</button>
            <button onclick="testJudge0('javascript', 'input')">Input Processing</button>
            <button onclick="testJudge0('javascript', 'math')">Math Operations</button>
            <button onclick="testJudge0('javascript', 'complex')">Complex Algorithm</button>
            <button onclick="testJudge0('javascript', 'error')">Runtime Error</button>
            <div id="javascript-results" class="results" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üîß System Health Check</h3>
            <button onclick="checkHealth()">Check Judge0 Status</button>
            <div id="health-results" class="results" style="display: none;"></div>
        </div>
    </div>

    <script>
        let activeTests = new Set();

        async function testJudge0(language, testType) {
            const testId = `${language}-${testType}`;
            const resultsDiv = document.getElementById(`${language}-results`);
            const button = event.target;

            if (activeTests.has(testId)) return;

            activeTests.add(testId);
            button.disabled = true;
            button.innerHTML = '‚è≥ Running...';

            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = `üîÑ Executing ${language} ${testType} test...\n`;

            try {
                const startTime = Date.now();
                const response = await fetch('/api/test-judge0', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ language, testType })
                });

                const data = await response.json();
                const totalTime = Date.now() - startTime;

                if (data.success) {
                    resultsDiv.className = 'results success';
                    const exec = data.executionData;
                    
                    resultsDiv.innerHTML = `‚úÖ TEST COMPLETED SUCCESSFULLY
                    
üìä EXECUTION DETAILS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Language: ${language.toUpperCase()}
Test Type: ${testType.toUpperCase()}
Status: ${exec.status}
Success: ${exec.success ? '‚úÖ YES' : '‚ùå NO'}

‚è±Ô∏è PERFORMANCE METRICS:
Runtime: ${exec.runtime}ms
Memory Used: ${exec.memory}KB
Total Request Time: ${totalTime}ms
Judge0 Token: ${exec.details.token}

üì§ OUTPUT:
${exec.output || '(no output)'}

${exec.error ? `‚ö†Ô∏è ERROR:\n${exec.error}\n` : ''}
üîß TECHNICAL DETAILS:
Code Length: ${exec.testMetadata.codeLength} characters
Has Input: ${exec.testMetadata.hasInput ? 'Yes' : 'No'}
Input Length: ${exec.testMetadata.inputLength} characters
Status ID: ${exec.details.statusId}
Exit Code: ${exec.details.exitCode || 'N/A'}
Stderr: ${exec.details.stderr || 'None'}
Compile Output: ${exec.details.compileOutput || 'None'}

Timestamp: ${data.timestamp}`;
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `‚ùå TEST FAILED

Error: ${error.message}
Time: ${Date.now() - startTime}ms`;
            } finally {
                activeTests.delete(testId);
                button.disabled = false;
                button.innerHTML = button.innerHTML.replace('‚è≥ Running...', button.dataset.originalText || 'Test');
            }
        }

        async function checkHealth() {
            const resultsDiv = document.getElementById('health-results');
            const button = event.target;

            button.disabled = true;
            button.innerHTML = '‚è≥ Checking...';

            resultsDiv.style.display = 'block';
            resultsDiv.className = 'results loading';
            resultsDiv.innerHTML = 'üîÑ Checking Judge0 health status...\n';

            try {
                const response = await fetch('/api/health');
                const data = await response.json();

                if (data.judge0.connected) {
                    resultsDiv.className = 'results success';
                    resultsDiv.innerHTML = `‚úÖ JUDGE0 API STATUS: HEALTHY

üåê CONNECTION DETAILS:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Status: ‚úÖ Connected
Endpoint: ${data.judge0.endpoint}
API Provider: RapidAPI Judge0 CE
Test Execution: Successful

üìä TEST RESULTS:
Output: "Hello, World!"
Response Time: Fast
Authentication: ‚úÖ Valid API Key

‚ö° CAPABILITIES:
‚úÖ 15+ Programming Languages
‚úÖ Real-time Code Execution  
‚úÖ Memory & Time Limit Enforcement
‚úÖ Compilation Error Detection
‚úÖ Runtime Error Handling
‚úÖ Output Comparison
‚úÖ Test Case Validation

üéØ READY FOR PRODUCTION!

Timestamp: ${data.timestamp}`;
                } else {
                    throw new Error(data.judge0.error || 'Connection failed');
                }
            } catch (error) {
                resultsDiv.className = 'results error';
                resultsDiv.innerHTML = `‚ùå HEALTH CHECK FAILED

Error: ${error.message}`;
            } finally {
                button.disabled = false;
                button.innerHTML = 'Check Judge0 Status';
            }
        }

        // Store original button text
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('button').forEach(btn => {
                btn.dataset.originalText = btn.innerHTML;
            });
        });
    </script>
</body>
</html>
